{% comment %}
  Delivery Zone Selection Modal
  Supports three modes: Zipcode (with/without search), City, AutoDetect
{% endcomment %}

<div class="delivery-zone-modal" id="delivery-zone-modal" aria-hidden="true" data-show-modal="{{ deliveryZone.showModal }}">
  <div class="delivery-zone-overlay" data-zone-overlay></div>
  <div class="delivery-zone-panel" role="dialog" aria-label="Select delivery location">
    <header class="delivery-zone-header">
      <h3 class="delivery-zone-title">Enter pincode for delivery location</h3>
      <button class="delivery-zone-close" aria-label="Close" data-zone-close>
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </header>

    <div class="delivery-zone-content">
      <form class="delivery-zone-form" id="delivery-zone-form">
        {% if deliveryZone.mode == 0 %}
          {% comment %} Zipcode Mode {% endcomment %}
          {% if deliveryZone.zipcodeSearchEnabled %}
            {% include 'snippets/delivery-zone-search' %}
          {% else %}
            <div class="delivery-zone-input-group">
              <input 
                type="text" 
                id="delivery-zone-zipcode" 
                name="zipcode" 
                class="delivery-zone-input"
                placeholder="Enter Location"
                value="{{ deliveryZone.defaultZipcode }}"
                required
                maxlength="10">
              <svg class="delivery-zone-search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="11" cy="11" r="8"></circle>
                <path d="m21 21-4.35-4.35"></path>
              </svg>
            </div>
          {% endif %}
        {% elsif deliveryZone.mode == 1 %}
          {% comment %} City Mode {% endcomment %}
          {% include 'snippets/delivery-zone-city-selector' %}
        {% elsif deliveryZone.mode == 2 %}
          {% comment %} AutoDetect Mode {% endcomment %}
          <div class="delivery-zone-autodetect">
            <button type="button" class="btn btn-primary btn-lg delivery-zone-detect-btn" id="detect-location-btn">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 2v20M2 12h20"/>
              </svg>
              Detect My Location
            </button>
            <div class="delivery-zone-or-divider">
              <span>OR</span>
            </div>
            <div class="delivery-zone-input-group">
              <input 
                type="text" 
                id="delivery-zone-zipcode" 
                name="zipcode" 
                class="delivery-zone-input"
                placeholder="Enter Location"
                value="{{ deliveryZone.defaultZipcode }}">
              <svg class="delivery-zone-search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="11" cy="11" r="8"></circle>
                <path d="m21 21-4.35-4.35"></path>
              </svg>
            </div>
          </div>
        {% endif %}

        {% if deliveryZone.current %}
          <div class="delivery-zone-current">
            <p class="delivery-zone-current-label">Current location:</p>
            <p class="delivery-zone-current-value">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                <circle cx="12" cy="10" r="3"></circle>
              </svg>
              {{ deliveryZone.current.zoneName }} {{ deliveryZone.current.zipcode }}
            </p>
          </div>
        {% endif %}

        <div class="delivery-zone-error" id="delivery-zone-error" style="display: none;"></div>

        <div class="delivery-zone-actions">
          <button type="submit" class="btn btn-primary btn-lg delivery-zone-submit">
            Continue
          </button>
        </div>
      </form>
    </div>

    <div class="delivery-zone-loading" id="delivery-zone-loading" style="display: none;">
      <div class="spinner"></div>
      <p>Loading...</p>
    </div>
  </div>
</div>

<style>
.delivery-zone-modal { 
  position: fixed; 
  inset: 0; 
  z-index: 9999; 
  display: none; 
}

.delivery-zone-modal.active { 
  display: flex; 
  align-items: center; 
  justify-content: center; 
}

.delivery-zone-overlay { 
  position: absolute; 
  inset: 0; 
  background: rgba(0, 0, 0, 0.5); 
  backdrop-filter: blur(4px); 
}

.delivery-zone-panel { 
  position: relative; 
  background: white; 
  border-radius: 16px; 
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3); 
  width: 90%; 
  max-width: 500px; 
  max-height: 90vh; 
  overflow: hidden; 
  display: flex; 
  flex-direction: column; 
}

.delivery-zone-header { 
  display: flex; 
  align-items: center; 
  justify-content: space-between; 
  padding: 24px; 
  border-bottom: 1px solid #e5e7eb; 
}

.delivery-zone-title { 
  margin: 0; 
  font-size: 20px; 
  font-weight: 600; 
  color: #111827; 
}

.delivery-zone-close { 
  background: none; 
  border: none; 
  cursor: pointer; 
  color: #6b7280; 
  padding: 4px; 
  display: flex; 
  align-items: center; 
  justify-content: center; 
}

.delivery-zone-close:hover { 
  color: #111827; 
}

.delivery-zone-content { 
  padding: 24px; 
  overflow-y: auto; 
}

.delivery-zone-form { 
  display: flex; 
  flex-direction: column; 
  gap: 20px; 
}

.delivery-zone-input-group { 
  position: relative; 
  display: flex; 
  align-items: center; 
}

.delivery-zone-input { 
  width: 100%; 
  padding: 14px 48px 14px 20px; 
  border: 2px solid #a78bfa; 
  border-radius: 12px; 
  font-size: 16px; 
  transition: all 0.2s ease; 
  background: white; 
}

.delivery-zone-input:focus { 
  outline: none; 
  border-color: #7c3aed; 
  box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.1); 
}

.delivery-zone-search-icon { 
  position: absolute; 
  right: 16px; 
  color: #a78bfa; 
  pointer-events: none; 
}

.delivery-zone-autodetect { 
  display: flex; 
  flex-direction: column; 
  gap: 16px; 
}

.delivery-zone-detect-btn { 
  display: flex; 
  align-items: center; 
  justify-content: center; 
  gap: 8px; 
  width: 100%; 
  padding: 14px; 
  font-size: 16px; 
}

.delivery-zone-or-divider { 
  display: flex; 
  align-items: center; 
  gap: 12px; 
  text-transform: uppercase; 
  font-size: 12px; 
  font-weight: 600; 
  color: #6b7280; 
  text-align: center; 
}

.delivery-zone-or-divider::before,
.delivery-zone-or-divider::after { 
  content: ''; 
  flex: 1; 
  height: 1px; 
  background: #e5e7eb; 
}

.delivery-zone-current { 
  padding: 16px; 
  background: #f3f4f6; 
  border-radius: 8px; 
  display: flex; 
  flex-direction: column; 
  gap: 4px; 
}

.delivery-zone-current-label { 
  margin: 0; 
  font-size: 12px; 
  color: #6b7280; 
  text-transform: uppercase; 
  font-weight: 600; 
}

.delivery-zone-current-value { 
  margin: 0; 
  font-size: 14px; 
  color: #111827; 
  font-weight: 600; 
  display: flex; 
  align-items: center; 
  gap: 8px; 
}

.delivery-zone-error { 
  padding: 12px 16px; 
  background: #fef2f2; 
  border: 1px solid #fecaca; 
  border-radius: 8px; 
  color: #991b1b; 
  font-size: 14px; 
}

.delivery-zone-actions { 
  display: flex; 
  gap: 12px; 
}

.delivery-zone-submit { 
  flex: 1; 
  padding: 14px; 
  font-size: 16px; 
  font-weight: 600; 
}

.delivery-zone-loading { 
  position: absolute; 
  inset: 0; 
  background: rgba(255, 255, 255, 0.95); 
  display: flex; 
  flex-direction: column; 
  align-items: center; 
  justify-content: center; 
  gap: 16px; 
}

.spinner { 
  width: 40px; 
  height: 40px; 
  border: 4px solid #e5e7eb; 
  border-top-color: #a78bfa; 
  border-radius: 50%; 
  animation: spin 0.8s linear infinite; 
}

@keyframes spin { 
  to { transform: rotate(360deg); } 
}

/* Mobile responsive */
@media (max-width: 640px) {
  .delivery-zone-panel { 
    width: 100%; 
    max-width: 100%; 
    border-radius: 0; 
    height: 100%; 
    max-height: 100%; 
  }
  
  .delivery-zone-header { 
    padding: 16px; 
  }
  
  .delivery-zone-content { 
    padding: 16px; 
  }
  
  .delivery-zone-title { 
    font-size: 18px; 
  }
}
</style>


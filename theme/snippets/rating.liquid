{% comment %}
  Product Rating Display Snippet
  
  Displays product rating with stars and review count.
  Usage: {% render 'snippets/rating', product: product %}
{% endcomment %}

{% liquid
  assign product = product | default: null
  assign rating = rating | default: product.rating | default: product.averageRating | default: 0
  assign review_count = review_count | default: product.reviewCount | default: product.reviewsCount | default: 0
  assign show_count = show_count | default: true
  assign max_rating = max_rating | default: 5
  
  if rating == null or rating == empty
    assign rating = 0
  endif
  
  assign rating_float = rating | times: 1.0
  assign full_stars = rating_float | floor
  assign has_half_star = rating_float | modulo: 1 | times: 10 | round | divided_by: 10.0
  assign empty_stars = max_rating | minus: full_stars
  if has_half_star > 0
    assign empty_stars = empty_stars | minus: 1
  endif
%}

<div class="rating" data-rating="{{ rating }}" aria-label="Rating: {{ rating }} out of {{ max_rating }}">
  <div class="rating-stars" role="img" aria-label="{{ rating }} out of {{ max_rating }} stars">
    {% for i in (1..full_stars) %}
      <span class="rating-star rating-star-full" aria-hidden="true">★</span>
    {% endfor %}
    
    {% if has_half_star > 0 %}
      <span class="rating-star rating-star-half" aria-hidden="true">★</span>
    {% endif %}
    
    {% for i in (1..empty_stars) %}
      <span class="rating-star rating-star-empty" aria-hidden="true">☆</span>
    {% endfor %}
  </div>
  
  {% if show_count and review_count > 0 %}
    <span class="rating-count" data-rating-count>
      ({{ review_count }} {{ 'product.reviews' | t | default: 'review' | pluralize: review_count }})
    </span>
  {% endif %}
</div>

<style>
  .rating {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .rating-stars {
    display: inline-flex;
    gap: 0.125rem;
    font-size: 1rem;
    line-height: 1;
  }

  .rating-star {
    color: #fbbf24;
    font-size: 1rem;
  }

  .rating-star-empty {
    color: #e5e7eb;
  }

  .rating-star-half {
    background: linear-gradient(90deg, #fbbf24 50%, #e5e7eb 50%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .rating-count {
    font-size: 0.875rem;
    color: {{ settings.color_text_light }};
  }
</style>

